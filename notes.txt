
There are some mock data in the codebase. Please remove them and use the real data. and 



Load balacne when we are hit by more users beside vertical scaling. 

How big will it become globally?? Can we go that route?

Scaleability??

mcp? app database and so on 

Application and databace separated 

10K for 

Instead of rendering all the data at once, we can use pagination or infinite scroll to load data as needed. or perhapd plot random samples of the data say 2000 events out of XXX and also show the total number of events that were selected. this will help with performance and scalability and also transparancy 

there are some empty folders in the codebase. Please check them if they are needed or not and decide what to do with them. 



I want to implement user authentication and role-based access control (RBAC) for the Earthquake Catalogue Platform. The system should:

1. **User Authentication:**
   - Allow users to register and log in securely
   - Support session management
   - Integrate with the existing NextAuth.js setup (already configured in the codebase)

2. **Role-Based Access Control:**
   - Define different user roles (e.g., Admin, Editor, Viewer, Guest)
   - Control access to specific features based on user roles:
     - **Admin**: Full access to all features, user management, system settings
     - **Editor**: Can upload, import, merge, and export catalogues
     - **Viewer**: Can only view and export catalogues (read-only access)
     - **Guest**: Limited access to public catalogues only

3. **Feature-Level Permissions:**
   - Protect API endpoints based on user roles
   - Control UI elements (hide/show buttons, menus based on permissions)
   - Secure operations like:
     - Catalogue upload and creation
     - Data import from GeoNet
     - Catalogue merging
     - Data export
     - System settings access

4. **Implementation Requirements:**
   - Use the existing MongoDB database to store user roles and permissions
   - Integrate with the current API rate limiting system
   - Maintain compatibility with the existing codebase architecture
   - Provide a user management interface for admins

Can you help me implement this authentication and authorization system for the platform?


I need to implement a comprehensive user authentication and role-based access control (RBAC) system for the Earthquake Catalogue Platform. Based on the existing codebase that already has NextAuth.js configured and MongoDB collections defined, please help me build the following components:

**1. User Authentication System:**
- Create user registration and login pages using NextAuth.js
- Implement secure session management with JWT tokens
- Add password hashing and validation
- Create user profile management functionality
- Integrate with the existing MongoDB `users` and `sessions` collections

**2. Role-Based Access Control (4 distinct roles):**
- **Admin**: Full system access including user management, system settings, all CRUD operations
- **Editor**: Can create, upload, import, merge, and export catalogues; cannot manage users or system settings
- **Viewer**: Read-only access to all catalogues with export capabilities; cannot create or modify data
- **Guest**: Limited access to only public/demo catalogues; no export or modification rights

**3. Database Schema Extensions:**
- Extend the existing MongoDB `users` collection with role and permissions fields
- Create a `user_roles` collection to define role capabilities
- Add user assignment functionality for admins to manage user roles
- Ensure compatibility with existing collections (`merged_catalogues`, `merged_events`, etc.)

**4. API Security Implementation:**
- Add authentication middleware to protect all API routes in `/app/api/`
- Implement role-based authorization checks for each endpoint
- Integrate with the existing rate limiting system in `lib/rate-limiter.ts`
- Secure specific operations:
  - POST/PUT/DELETE `/api/catalogues/*` (Editor+ only)
  - POST `/api/import/geonet` (Editor+ only)
  - POST `/api/merge` (Editor+ only)
  - GET `/api/catalogues/*/export` (Viewer+ only)
  - User management endpoints (Admin only)

**5. Frontend Access Control:**
- Create a permissions context/hook for role-based UI rendering
- Hide/show navigation items, buttons, and pages based on user roles
- Add role-based route protection using Next.js middleware
- Implement user management interface for admins (assign roles, view users, etc.)

**6. Integration Requirements:**
- Maintain compatibility with existing codebase architecture
- Work with current MongoDB connection in `lib/mongodb.ts`
- Integrate with existing error handling in `lib/errors.ts`
- Preserve all existing functionality while adding security layers

**7. Specific Implementation Deliverables:**
- Authentication pages (`/login`, `/register`, `/profile`)
- Admin user management page (`/admin/users`)
- Role-based middleware for API routes
- Frontend permission hooks and components
- Database migration scripts for user roles
- Updated API documentation with authentication requirements

Please provide step-by-step implementation with code examples, starting with the database schema and authentication setup, then moving to API protection and frontend integration.